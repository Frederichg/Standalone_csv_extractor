Project Standalone_CSV_extractor

Context:

We have lots of .csv files that are generated by a behavior analysis system. All the files has the same basic structure but there is many different type of experiments. So the logic is constant but the details are changing.

I have many student whom are not familiar with programming so I do not what them to risk doing the extraction wrong but I do not what to do all those extraction my self. So the end result I want my student to be able to run this on their own computer (pc or mac) with a very simple deployment. So if possible, no need to install python on their machine only to install this program with everything needed included in the package. There will be a simple GUI that I will explain later. For a first version, we do not need to have the .exe and packaging, I just mention it so you can use toolbox that are easier to parkage and require no or few dependencies.  The progam will be in Python.

Each student is responsible for a serie of experiments and they have an excel sheet that we call the catalogue. In this excel file the name of all the differents single animal on each day is on one column. I put you an example CMF_Catalogue.xlsx if you open it and go to sheet called 'data' you will see the first column is all the name of the different files. Others columns are other informations that the student add. In column F (in this case, but not always F), it indicate the type of experiement the .csv file is about. 

So the first part of the program is to have a simple GUI. At the top there a 'browse' button to select the catalog file since the name and the location can change a browser will be the best. An this will set the path for where to find all the .csv files and the output files that we will talk about shortly. So once the catalogue file is set, there should be en input box to write the sheet name. In the present case 'data'. Then have 3 dropdown menu, one to select the column with the file names and one to select the column to select the type of experiement. It would be nice if the items on the dropdown will be the actual column names. So that way we minimise the risk of taking a wrong column.  For the last dropdown menu, this will display the different item found in the column about the type of experiment. Only  one time each types (unique).



The second part is the data extraction from the .csv files

To do this you open sequentialy all the files that correspond to the drop downdown that has been has selected. For example, line 19 to 21 then may more are all analyse type 'TE' in the 'F' column. So we go first with this file at A19 2025_08_22__13_57_15_594.csv do the extraction then pass to the next one.

We need to open the .csv first. I already experiement some issue with that part because there is the header and there something french accent and the number of column may vary inside the .csv file so here a part of code that work (the file name here is just an example):

csv_df = pd.read_csv('data/2025_07_25__16_32_12_594.csv',

    skiprows=11,

    usecols=range(8),

    encoding='latin-1',

    header=None,

    names=['Num_line','S', 'MS', 'Cat', 'Num_cat', 'state', 'Display', 'null'])

csv_df

To do the extraction the student has to give you in a inputbox the marker for trials. In a single .csv there could be 10 to more than 100 tirals, there always a marker for it but it can change from one experiement to the other. I put you an example 2025_08_20__16_43_04_655.csv in this folder so you can see how the data looks. So, once you open the first file you can identify all the unique 'state' and display it in the Trial separator dropdown menu. In the example this is in column F 'MagEntry' then on the right of this dropdown menu you can display the unique that you find in column D for this marker 'MagEntry' that you found in F. In this case probabley 'Exit' and 'Entry'? Then on the right you can add a button 'find trials', when pressed it will dispaly the number of 'MagEntry' with let say 'Exit' that the progam find. Again more right another display box that will give the line number of the first few trial just to be able to manually verify. 'Finish' in line D indicate the experiment stop there so it is possible the last trial is not completed. And usually one trial finish as the next one is starting, I mean it is the same marker.

Now the trial by trail extraction.

Now that you have the line number of each trial we need to extract what happen during each trial. To do so, you take one buy one the trial and look for some markers. So, for this part in GUI I would put like 15 lines. Each lines will be to specify a marker. So the line in the GUI will start with let say Marker1 then a dropmenu with all the unique found in the column F. Then a check box to indicate if there a reward. If check add another dropdown with all those unique again (if not check just make the dropmenu unavaillable gray). Some condition do not lead to a reward so we are only interested to know what the animal has answered and when, but if the animal is giving a good answer that may triger a reward so in this case there will be a second marker to look for in this trial so another dropdown with all the unique agrain. Now that we know what to look for lets define what we will do with those markers. So you will do a DF for all trial together, in column 1 the trial number, column 2 the line the trial start, column 3 the line the trial stop. Colum 4 will be the time at the begining of the trial from the begining of the experiement, to calculate this is only need to take the column 'S' for second and 'MS' for millisecond and put all in MS. Then find the marker1 (indicated by the dropdown menu) in the next columIf the marker is found just put '1' in the column and '0' if not. On a next column the time in MS minus the time from the trial start (so we would have the time relative to the trial start). If the reward check box is check add two new column one for the reward marker and one for the timing.  If there is no reward check just continue to the next Marker2, 3,4,5.... Altough there is 15 lines of marker availlaible most student only going to use around 5 to 10 so if they are not puting anything in the remaining lines consider that the student do not need more.


Ouput

One all the previous extraction has be done there will be 2 differents output. 1- You can save the original .csv as an excel file since this is much more convinient for the student to not have to deal with .csv, on this output excel file you can keep the original name but exchange the .csv to .xlsx.  The original data will be on a sheet named 'raw'. You will create another sheet name 'trial' with what you just did in the extraction section. You will add a one line header that indicate the marker name and the marker time.  You will create another sheet name 'header', you remeber when we open the .csv file we drop the header, you can reopen the .csv to copy the header that we had discarded and put all those information in that sheet. Thos new files can be saved in a folder that you will created if not already in the main folder idenfied in by the browser at the befining, that you can call processed_data.

The second output is an agragator instead of having all the individual files it will create an excel file with the reduced data form each .csv into one line. So one line per anlaysed file. First column the .xlsx file name (that we just did in the previous paragraph). Then, all the addition of the number of marker1, then the average time for marker1, etc... Put a header to indicate the marker name on each column. For the name of this file you can compound the name of the catalogue that we enter previously then sheet name then analyse type. 

At the bottom right of the GUI there will be a button to start the 'data crunching' next to the button there will be a dispay that will indicate crunchin X out of Y. X being the actual file number that is on process and Y is the total number of the file to do.
